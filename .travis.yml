sudo: required
language: cpp

addons: &gcc9
  apt:
    packages:
      - g++-9
      - cmake
      - libopenmpi-dev
      - openmpi-bin
      - openmpi-common
    sources:
      - ubuntu-toolchain-r-test

addons: &gcc10
  apt:
    packages:
      - g++-10
      - cmake
      - libopenmpi-dev
      - openmpi-bin
      - openmpi-common
    sources:
      - ubuntu-toolchain-r-test

matrix:
  include:
    - env: GCC_VERSION=9
      os: linux
      dist: xenial
      addons: *gcc9
    - env: GCC_VERSION=9
      os: linux
      dist: bionic
      addons: *gcc9
    - env: GCC_VERSION=10
      os: linux
      dist: bionic
      addons: *gcc10

before_install:
  - sudo apt-get -qq update
  - test -n $CXX && unset CXX

before_script:
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-${GCC_VERSION} 10
  - export CXX="g++-${GCC_VERSION}" CC="gcc-${GCC_VERSION}"

script:
  - cmake -DSIMPLEMR_BUILD_TEST=ON .
  - make VERBOSE=1 -j 2
  - ctest -VV

branches:
  only:
    - dev
    - master

notifications:
  email: false
